//
//  {{toneburstName}}.swift
//
//
//  Created by Mafalda on 3/5/24.
//

import Foundation

import Chord
import Datable
import Ghostwriter
import ReplicantSwift
import TransmissionAsync

public enum {{toneburstName}}Mode: String, Codable
{
    {% for mode in modes %}
    case {{mode}}
    {% endfor %}
}

public class {{toneburstName}}Async: ToneBurstAsync, Codable
{
    public var type: ReplicantSwift.ToneBurstType
    
    let mode: {{toneburstName}}Mode

    public init(_ mode: {{toneburstName}}Mode)
    {
        self.mode = mode
        self.type = .starburst
    }

    public func perform(connection: TransmissionAsync.AsyncConnection) async throws
    {
        let instance = {{toneburstName}}InstanceAsync(self.mode, connection)
        try await instance.perform()
    }
}

public struct {{toneburstName}}InstanceAsync
{
    let connection: TransmissionAsync.AsyncConnection
    let mode: {{toneburstName}}Mode

    public init(_ mode: {{toneburstName}}Mode, _ connection: TransmissionAsync.AsyncConnection)
    {
        self.mode = mode
        self.connection = connection
    }

    public func perform() async throws
    {
        switch mode
        {
            case .NOMNImode:
                try await handleNOMNImode()
        }
    }

    func handleNOMNImode() async throws
    {

    }

}

public enum {{toneburstName}}Error: Error
{
    case timeout
    case connectionClosed
    case writeFailed
    case readFailed
    case listenFailed
    case speakFailed
    case maxSizeReached
}
